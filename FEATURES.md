# 富途 MCP 服务器功能详解

基于[富途OpenAPI文档](https://openapi.futunn.com/futu-api-doc/)实现的完整功能列表。

## 📈 行情数据功能

### 1. 自选股管理 (get_watchlist)

获取用户在富途客户端中设置的自选股列表。

**功能特点:**
- 支持多市场自选股（美股、港股、A股）
- 返回股票代码和名称的映射
- 实时同步富途客户端的自选股分组

**使用场景:**
- 快速查看关注的股票列表
- 批量获取自选股的报价信息
- 投资组合管理

### 2. 实时报价 (get_stock_quote)

获取指定股票的实时报价信息，包括价格、成交量、涨跌幅等。

**数据字段:**
- 最新价、开盘价、昨收价
- 最高价、最低价
- 成交量、成交额
- 涨跌额、涨跌幅
- 更新时间、市场状态

**支持市场:**
- 美股 (US): 如 US.AAPL
- 港股 (HK): 如 HK.00700
- 沪股 (SH): 如 SH.000001
- 深股 (SZ): 如 SZ.000001

### 3. 历史数据 (get_stock_history)

获取股票的历史K线数据，支持多种时间周期。

**时间周期:**
- 分钟级: 1min, 5min, 15min, 30min, 60min
- 日级: day, week, month

**数据字段:**
- 开盘价、最高价、最低价、收盘价 (OHLC)
- 成交量、成交额
- 涨跌额、涨跌幅
- 时间戳

**应用场景:**
- 技术分析
- 趋势研究
- 量化策略开发

### 4. 股票搜索 (search_stock)

根据股票名称或代码搜索相关股票。

**搜索功能:**
- 支持中英文名称搜索
- 支持股票代码搜索
- 支持模糊匹配
- 可指定搜索市场范围

**返回信息:**
- 股票代码、股票名称
- 所属市场、股票类型
- 上市状态

### 5. 市场快照 (get_market_snapshot)

获取主要市场指数和概览信息。

**支持市场:**
- 美股: 标普500 (SPY), 纳斯达克 (QQQ), 道琼斯 (DIA)
- 港股: 恒生指数, 恒生科技指数
- A股: 上证指数, 深证成指

**数据内容:**
- 指数最新价格
- 涨跌幅情况
- 更新时间

## 💰 交易功能（需要交易权限）

### 6. 账户信息 (get_account_info)

获取交易账户的资金和基本信息。

**账户类型:**
- 真实账户 (REAL)
- 模拟账户 (SIMULATE)

**资金信息:**
- 总资产、现金余额
- 股票市值
- 可用资金、购买力
- 更新时间

### 7. 持仓信息 (get_positions)

获取当前持有的股票仓位信息。

**持仓数据:**
- 股票代码、股票名称
- 持仓数量、可卖数量
- 成本价、当前价
- 市值、盈亏金额
- 盈亏比例、持仓方向

## ⚙️ 系统配置功能

### 8. 客户端配置 (configure_futu_client)

动态配置富途API客户端的连接参数。

**配置项:**
- API主机地址
- API端口号
- 解锁密码（用于交易功能）

### 9. 连接状态 (get_client_status)

获取富途客户端的连接状态和配置信息。

**状态信息:**
- 连接状态（已连接/未连接）
- 当前配置（主机、端口）
- 最后错误信息

## 🔧 技术实现

### API架构

```
Cursor/AI助手
    ↓ (MCP协议)
富途MCP服务器
    ↓ (富途API)
富途OpenD客户端
    ↓ (网络协议)
富途服务器
```

### 数据流程

1. **行情数据流程:**
   - AI助手发送MCP请求
   - MCP服务器调用富途API
   - 富途OpenD返回实时数据
   - 格式化后返回给AI助手

2. **交易数据流程:**
   - 需要先解锁交易权限
   - 通过交易API获取账户信息
   - 支持模拟和真实账户

### 错误处理

- 连接失败自动重试
- 详细的错误信息提示
- 优雅的降级处理
- 完整的日志记录

## 🚀 使用建议

### 最佳实践

1. **开发环境:**
   - 使用模拟账户进行测试
   - 先测试行情功能再测试交易功能
   - 定期检查连接状态

2. **生产环境:**
   - 配置适当的解锁密码
   - 监控API调用频率
   - 设置合理的超时时间

3. **安全考虑:**
   - 不要在代码中硬编码密码
   - 使用环境变量管理敏感信息
   - 定期更新API密钥

### 性能优化

- 合理使用数据缓存
- 避免频繁的API调用
- 批量处理多个股票查询
- 使用异步处理提高响应速度

## 📚 相关文档

- [富途OpenAPI官方文档](https://openapi.futunn.com/futu-api-doc/)
- [MCP协议规范](https://modelcontextprotocol.io/)
- [富途Python SDK](https://github.com/FutunnOpen/py-futu-api)

## 🔄 版本更新

### v1.1.0 (当前版本)
- ✅ 新增股票实时报价功能
- ✅ 新增历史K线数据获取
- ✅ 新增股票搜索功能
- ✅ 新增市场快照功能
- ✅ 新增账户信息查询
- ✅ 新增持仓信息查询
- ✅ 完善错误处理和日志记录

### v1.0.0
- ✅ 基础MCP服务器框架
- ✅ 自选股列表获取
- ✅ 客户端配置管理
- ✅ 连接状态监控 